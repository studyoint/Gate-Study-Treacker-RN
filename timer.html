<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Study Sprint Tracker</title>
  <!-- <link rel="stylesheet" href="style3.css"/> -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet" />
  <style>
    /* === Import Fonts === */
@import url('https://fonts.googleapis.com/css2?family=Inter&family=Orbitron:wght@600&display=swap');

/* === Base Reset === */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  background-color: #121212;
  font-family: 'Inter', sans-serif;
  color: #ffffff;
  min-height: 100vh;
  padding: 20px;
  display: flex;
  justify-content: center;
  align-items: center;
  overflow-x: hidden;
  position: relative;
  z-index: 0;
}

/* === Scrollbar === */
::-webkit-scrollbar {
  width: 8px;
}
::-webkit-scrollbar-track {
  background: #1e1e1e;
}
::-webkit-scrollbar-thumb {
  background: #00ffff;
  border-radius: 10px;
}

/* === Animations === */
@keyframes fadeIn {
  0% { opacity: 0; transform: scale(0.95); }
  100% { opacity: 1; transform: scale(1); }
}
@keyframes pulseGlow {
  0% { box-shadow: 0 0 5px #00ffff; }
  50% { box-shadow: 0 0 15px #00ffff; }
  100% { box-shadow: 0 0 5px #00ffff; }
}

/* === Fullscreen Toggle Button === */
#fullscreen-btn {
  position: fixed;
  top: 20px;
  right: 20px;
  background-color: #00bcd4;
  color: #fff;
  padding: 10px 15px;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  z-index: 1001;
  box-shadow: 0 0 8px #00ffff;
  transition: 0.3s ease;
}
#fullscreen-btn:hover {
  background-color: #00ffff;
  color: #121212;
  transform: translateY(-3px) scale(1.05);
  box-shadow: 0 0 12px #00ffff, 0 0 24px #00ffff;
}

/* === Fullscreen Overlay === */
#fullscreen-overlay {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: 100vw;
  background-color: #121212;
  z-index: 999;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  color: #00ffff;
  text-align: center;
  animation: fadeIn 0.6s ease-in-out;
}
#fullscreen-overlay.show {
  display: flex;
}
#fullscreen-overlay h1 {
  font-size: 3rem;
  margin-bottom: 20px;
  font-family: 'Orbitron', sans-serif;
}
#fullscreen-timer {
  font-size: 4rem;
  font-weight: bold;
  letter-spacing: 2px;
}

/* === Main App Container === */
.container {
  width: 100%;
  max-width: 100%;
  background-color: rgba(30, 30, 30, 0.75);
  backdrop-filter: blur(10px);
  padding: 30px;
  border-radius: 16px;
  box-shadow: 0 0 15px rgba(0, 255, 255, 0.2);
  border: 1px solid rgba(0, 255, 255, 0.2);
  animation: fadeIn 0.6s ease-in-out;
  position: relative;
  z-index: 1;
}

/* === Headings === */
h1, h2 {
  text-align: center;
  margin-bottom: 20px;
  color: #00ffff;
  font-family: 'Orbitron', sans-serif;
  letter-spacing: 1px;
}

/* === Timer Display === */
.timer-section {
  margin-bottom: 30px;
}
.time-block {
  display: flex;
  justify-content: space-between;
  font-size: 1.8rem;
  margin: 10px 0;
  padding: 10px;
  background-color: #2a2a2a;
  border-radius: 8px;
}

/* === Progress Bar === */
.progress-bar-wrapper {
  width: 100%;
  height: 10px;
  background-color: #333;
  border-radius: 20px;
  overflow: hidden;
  margin-top: 10px;
}
.progress-bar {
  height: 100%;
  background: linear-gradient(to right, #00ffff, #00ff99);
  width: 0%;
  transition: width 0.5s ease-in-out;
  animation: pulseGlow 2s infinite;
}

/* === Sprint Input Section === */
.sprint-setup {
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 10px;
  margin-bottom: 20px;
}
.sprint-setup input {
  width: 60px;
  padding: 8px;
  font-size: 1rem;
  border: none;
  border-radius: 6px;
  text-align: center;
  background-color: #333;
  color: #fff;
}
.sprint-setup input:focus {
  box-shadow: 0 0 10px #00ffff;
  border: 1px solid #00ffff;
}
.sprint-setup button {
  padding: 10px 20px;
  border: none;
  border-radius: 10px;
  background-color: #00bcd4;
  color: #fff;
  font-weight: bold;
  cursor: pointer;
  box-shadow: 0 0 8px #00ffff;
  transition: all 0.3s ease;
}
.sprint-setup button:hover {
  background-color: #00ffff;
  color: #121212;
  transform: scale(1.05);
}

/* === Controls === */
.controls {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 15px;
  margin: 20px 0;
  flex-wrap: wrap;
}
.controls button {
  padding: 12px 20px;
  font-size: 1rem;
  border: none;
  border-radius: 10px;
  cursor: pointer;
  background-color: #444;
  color: #fff;
  box-shadow: 0 0 5px #00ffff;
  transition: all 0.3s ease;
    position: relative;
  z-index: 99999;
  border: 2px solid limegreen !important;
}
.controls button:hover {
  background-color: #00ffff;
  color: #121212;
  transform: scale(1.05);
}
.active-button {
  background-color: #00ffff !important;
  color: #121212 !important;
  box-shadow: 0 0 10px #00ffff;
  transform: scale(1.08);
}

/* === Mode Section === */
.mode-selection {
  text-align: center;
  margin-bottom: 20px;
}
.mode-selection input[type="radio"] {
  margin-right: 6px;
}
#mode-status {
  margin-top: 10px;
  font-style: italic;
  color: #ccc;
}

/* === Status Info === */
.status-display p {
  margin: 8px 0;
  padding: 6px 10px;
  border-radius: 6px;
  font-size: 0.95rem;
  background-color: #2a2a2a;
}
.status-display .status-true {
  color: #00e676;
  font-weight: bold;
}
.status-display .status-false {
  color: #ff5252;
  font-weight: bold;
}

/* === Log List === */
.log-section {
  margin-top: 20px;
}
#log-list {
  list-style: none;
  padding: 0;
  margin-top: 10px;
}
#log-list li {
  display: flex;
  justify-content: space-between;
  padding: 8px 10px;
  background-color: #252525;
  margin-bottom: 5px;
  border-radius: 6px;
  font-size: 0.95rem;
}

/* === Analytics Section === */
.analytics {
  margin-top: 30px;
}
.analytics h2 {
  color: #00ffff;
  text-align: center;
  margin-bottom: 10px;
}
#analytics-list {
  list-style: none;
  padding: 0;
  margin: 0 auto;
  max-width: 400px;
}
#analytics-list li {
  display: flex;
  justify-content: space-between;
  padding: 8px 10px;
  background-color: #2a2a2a;
  border-radius: 6px;
  margin-bottom: 5px;
  font-size: 0.95rem;
}

/* === Popup Notes === */
.popup.hidden {
  display: none;
}
.popup {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: #1e1e1e;
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 0 10px #00ffff;
  z-index: 10000;
  width: 90%;
  max-width: 400px;
  text-align: center;
  animation: fadeIn 0.6s ease-in-out;
}
.popup textarea {
  width: 100%;
  height: 100px;
  padding: 10px;
  background: #2a2a2a;
  border: none;
  color: #fff;
  margin-bottom: 10px;
  border-radius: 6px;
}
.popup textarea:focus {
  box-shadow: 0 0 10px #00ffff;
  border: 1px solid #00ffff;
}
.popup button {
  padding: 10px 15px;
  background-color: #00bcd4;
  border: none;
  border-radius: 8px;
  color: #fff;
  font-weight: bold;
  cursor: pointer;
}
.popup button:hover {
  background-color: #00ffff;
  color: #121212;
}

/* === Title Setup === */
.title-setup {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 10px;
  margin: 20px 0;
  flex-wrap: wrap;
}
.title-setup input {
  padding: 10px 15px;
  width: 25%;
  font-size: 1rem;
  border: none;
  border-radius: 6px;
  background-color: #333;
  color: #fff;
  box-shadow: 0 0 5px rgba(0, 255, 255, 0.3);
  transition: 0.3s;
}
.title-setup input::placeholder {
  color: #aaa;
}
.title-setup input:focus {
  outline: none;
  box-shadow: 0 0 10px #00ffff;
  border: 1px solid #00ffff;
}
.title-setup button {
  padding: 10px 18px;
  border: none;
  border-radius: 6px;
  background-color: #00bcd4;
  color: #fff;
  font-weight: bold;
  cursor: pointer;
  box-shadow: 0 0 8px #00ffff;
  transition: all 0.3s ease;
}
.title-setup button:hover {
  background-color: #00ffff;
  color: #121212;
  transform: scale(1.05);
}

/* === Responsive Design === */
@media (max-width: 768px) {
  .container {
    max-width: 500px;
  }
  .controls,
  .sprint-setup,
  .title-setup {
    flex-direction: column;
    align-items: stretch;
  }
  .sprint-setup input,
  .sprint-setup button,
  .title-setup input,
  .title-setup button,
  .controls button {
    width: 100%;
  }
}

@media (max-width: 480px) {
  h1, h2 {
    font-size: 1.5rem;
  }
  #fullscreen-overlay h1 {
    font-size: 2rem;
  }
  #fullscreen-timer {
    font-size: 2.5rem;
  }
  .time-block {
    font-size: 1.2rem;
    flex-direction: column;
    text-align: center;
  }
  .popup textarea {
    height: 80px;
  }
  #fullscreen-btn {
    padding: 8px 12px;
    font-size: 0.9rem;
  }
}

  </style>
</head>
<body>

  <!-- Fullscreen Button -->
  <button id="fullscreen-btn">⛶ Full Screen</button>

  <!-- App Container -->
  <div class="container">
    <!-- App Title -->
    <h1>⏱ RN Study Sprint </h1>

    <!-- Custom Title Input -->
    <div class="title-setup">
      <input type="text" id="custom-title-input" placeholder="Enter your Sprint Title" />
      <button id="save-title-btn">Save Title</button>
    </div>

    <!-- Timer Display -->
    <div class="timer-section">
      <div id="elapsed-time" class="time-block">
        <label>Elapsed Time</label>
        <span>00:00:00</span>
      </div>
      <div id="remaining-time" class="time-block">
        <label>Time Left</label>
        <span>00:00:00</span>
      </div>
      <div class="progress-bar-wrapper">
        <div id="progress-bar" class="progress-bar"></div>
      </div>
    </div>

    <!-- Sprint Goal -->
    <div class="sprint-setup">
      <h2>🎯 Set Sprint Goal</h2>
      <input type="number" id="hours" placeholder="HH" min="0"/>
      <input type="number" id="minutes" placeholder="MM" min="0" max="59"/>
      <input type="number" id="seconds" placeholder="SS" min="0" max="59"/>
      <button id="set-sprint">Set Sprint</button>
    </div>

    <!-- Controls -->
    <div class="controls">
      <button id="start-btn">▶️ Start</button>
      <button id="pause-btn">⏸ Pause</button>
      <button id="reset-btn">🔄 Reset</button>
    </div>

    <!-- Mode Selection -->
    <div class="mode-selection">
      <h2>🎛️ Select Mode</h2>
      <label><input type="radio" name="mode" value="focus" checked/> Focus Mode</label>
      <label><input type="radio" name="mode" value="video"/> Video Mode</label>
      <p id="mode-status">Current Mode: Focus</p>
    </div>

  
    <!-- Daily Logs -->
    <div class="log-section">
      <h2>📅 Daily Log</h2>
      <ul id="log-list"></ul>
    </div>

    <!-- Analytics Dashboard -->
    <div class="analytics">
      <h2>📊 Weekly Analytics</h2>
      <ul id="analytics-list"></ul>
    </div>
  </div>

  <!-- Session Notes Popup -->
  <div id="notes-popup" class="popup hidden">
    <h2>📝 Sprint Notes</h2>
    <textarea id="notes-text" placeholder="What did you study?"></textarea>
    <button id="save-note-btn">Save Note</button>
  </div>

  <!-- Fullscreen Overlay Display -->
  <div id="fullscreen-overlay" class="hidden">
    <h1 id="fullscreen-title">📘 Study Sprint</h1>
    <div id="fullscreen-timer">00:00:00</div>
  </div>
  <div id="calendar-wrapper" class="calendar-container"></div>

  <!-- <script src="script.js"></script> -->
   <script>
    let elapsedSeconds = 0;
let sprintGoalSeconds = 0;
let sprintSet = false;
let currentMode = "focus";
let timerInterval = null;
let lastDate = getISTDate();
let customTitle = "";

// DOM References
const elapsedTimeDisplay = document.querySelector("#elapsed-time span");
const remainingTimeDisplay = document.querySelector("#remaining-time span");
const progressBar = document.getElementById("progress-bar");
const startBtn = document.getElementById("start-btn");
const pauseBtn = document.getElementById("pause-btn");
const resetBtn = document.getElementById("reset-btn");
const setSprintBtn = document.getElementById("set-sprint");
const modeRadios = document.querySelectorAll('input[name="mode"]');
const modeStatus = document.getElementById("mode-status");
const fileStatus = document.getElementById("file-status");
const tabStatus = document.getElementById("tab-status");
const logList = document.getElementById("log-list");
const fullscreenBtn = document.getElementById("fullscreen-btn");
const fullscreenOverlay = document.getElementById("fullscreen-overlay");
const fullscreenTimer = document.getElementById("fullscreen-timer");
const titleInput = document.getElementById("custom-title-input");
const saveTitleBtn = document.getElementById("save-title-btn");
const fullscreenTitle = document.getElementById("fullscreen-title");

window.addEventListener("DOMContentLoaded", () => {
  loadFromLocal();
  updateDisplay();
  renderLogList();
  checkFilePath();
  checkTabVisibility();
  setInterval(autoResetDaily, 60 * 1000);
});

function startTimer() {
  if (timerInterval) return;
  if (currentMode === "video") {
    if (!checkFilePath() || document.visibilityState !== "visible") {
      alert("❌ Video Mode needs RN Player file and tab focus.");
      return;
    }
  }
  timerInterval = setInterval(() => {
    elapsedSeconds++;
    updateDisplay();
    saveToLocal();

    if (sprintSet && elapsedSeconds >= sprintGoalSeconds) {
      pauseTimer();
      logTodayTime();
      renderLogList();
      alert("🎉 Sprint Complete!");
    }
  }, 1000);
}

function pauseTimer() {
  clearInterval(timerInterval);
  timerInterval = null;
  saveToLocal();
}

function resetTimer() {
  pauseTimer();
  logTodayTime();
  elapsedSeconds = 0;
  sprintGoalSeconds = 0;
  sprintSet = false;
  saveToLocal();
  updateDisplay();
  renderLogList();
}

function updateDisplay() {
  const formattedElapsed = formatTime(elapsedSeconds);
  elapsedTimeDisplay.textContent = formattedElapsed;

  if (sprintSet) {
    const remaining = Math.max(0, sprintGoalSeconds - elapsedSeconds);
    remainingTimeDisplay.textContent = formatTime(remaining);
    progressBar.style.width = `${calculateProgress()}%`;

    if (fullscreenOverlay.classList.contains("show")) {
      fullscreenTimer.textContent = formatTime(remaining);
    }
  } else {
    remainingTimeDisplay.textContent = "00:00:00";
    progressBar.style.width = "0%";

    if (fullscreenOverlay.classList.contains("show")) {
      fullscreenTimer.textContent = formattedElapsed;
    }
  }
}

function calculateProgress() {
  return Math.min(100, (elapsedSeconds / sprintGoalSeconds) * 100).toFixed(1);
}

modeRadios.forEach((radio) => {
  radio.addEventListener("change", () => {
    currentMode = document.querySelector('input[name="mode"]:checked').value;
    modeStatus.textContent = `Current Mode: ${currentMode}`;
    saveToLocal();
    checkFilePath();
    checkTabVisibility();
  });
});

function checkFilePath() {
  const valid = location.href.includes("RN%20Player") || location.href.includes("RN Player");
  fileStatus.textContent = `RN Player File: ${valid ? "✅" : "❌"}`;
  fileStatus.className = valid ? "status-true" : "status-false";
  if (!valid && currentMode === "video") pauseTimer();
  return valid;
}

document.addEventListener("visibilitychange", checkTabVisibility);

function checkTabVisibility() {
  const isVisible = document.visibilityState === "visible";
  tabStatus.textContent = `Tab Visible: ${isVisible ? "✅" : "❌"}`;
  tabStatus.className = isVisible ? "status-true" : "status-false";
  if (!isVisible && currentMode === "video") pauseTimer();
  if (isVisible && currentMode === "video" && checkFilePath()) startTimer();
}

function getISTDate() {
  return new Date().toLocaleDateString("en-GB", { timeZone: "Asia/Kolkata" });
}

function logTodayTime() {
  const today = getISTDate();
  let log = JSON.parse(localStorage.getItem("study_log") || "{}");
  if (!log[today]) log[today] = 0;
  log[today] += elapsedSeconds;
  localStorage.setItem("study_log", JSON.stringify(log));
}

function renderLogList() {
  logList.innerHTML = "";
  const log = JSON.parse(localStorage.getItem("study_log") || "{}");
  const dates = Object.keys(log).reverse();
  dates.forEach((d) => {
    const li = document.createElement("li");
    li.innerHTML = `<span>${d}</span><span>${formatTime(log[d])}</span>`;
    logList.appendChild(li);
  });
}

function autoResetDaily() {
  const today = getISTDate();
  if (today !== lastDate) {
    logTodayTime();
    elapsedSeconds = 0;
    lastDate = today;
    saveToLocal();
    renderLogList();
    updateDisplay();
  }
}

function saveToLocal() {
  localStorage.setItem("study_data", JSON.stringify({
    elapsedSeconds,
    sprintGoalSeconds,
    sprintSet,
    currentMode,
    date: getISTDate(),
    customTitle
  }));
}

function loadFromLocal() {
  const saved = JSON.parse(localStorage.getItem("study_data") || "{}");
  if (saved.date === getISTDate()) {
    elapsedSeconds = saved.elapsedSeconds || 0;
    sprintGoalSeconds = saved.sprintGoalSeconds || 0;
    sprintSet = saved.sprintSet || false;
    currentMode = saved.currentMode || "focus";
    customTitle = saved.customTitle || "";
    document.querySelector(`input[value="${currentMode}"]`).checked = true;
    modeStatus.textContent = `Current Mode: ${currentMode}`;
    titleInput.value = customTitle;
    fullscreenTitle.textContent = customTitle || "Study Sprint";
  }
}

function formatTime(sec) {
  const h = String(Math.floor(sec / 3600)).padStart(2, "0");
  const m = String(Math.floor((sec % 3600) / 60)).padStart(2, "0");
  const s = String(sec % 60).padStart(2, "0");
  return `${h}:${m}:${s}`;
}

function flashButton(button) {
  button.classList.add("active-button");
  setTimeout(() => {
    button.classList.remove("active-button");
  }, 500);
}

// === Button Events ===
startBtn.addEventListener("click", () => {
  flashButton(startBtn);
  startTimer();
});
pauseBtn.addEventListener("click", () => {
  flashButton(pauseBtn);
  pauseTimer();
});
resetBtn.addEventListener("click", () => {
  flashButton(resetBtn);
  resetTimer();
});
setSprintBtn.addEventListener("click", () => {
  flashButton(setSprintBtn);
  const h = parseInt(document.getElementById("hours").value) || 0;
  const m = parseInt(document.getElementById("minutes").value) || 0;
  const s = parseInt(document.getElementById("seconds").value) || 0;
  const total = h * 3600 + m * 60 + s;
  if (total <= 0) return alert("❌ Invalid Sprint Time.");
  sprintGoalSeconds = total;
  sprintSet = true;
  elapsedSeconds = 0;
  updateDisplay();
  saveToLocal();
});

// === Fullscreen Toggle ===
fullscreenBtn.addEventListener("click", () => {
  fullscreenOverlay.classList.toggle("show");
  if (fullscreenOverlay.classList.contains("show")) {
    fullscreenBtn.textContent = "❌ Exit Fullscreen";
    fullscreenTimer.textContent = sprintSet
      ? formatTime(Math.max(0, sprintGoalSeconds - elapsedSeconds))
      : formatTime(elapsedSeconds);
    fullscreenTitle.textContent = customTitle || "Study Sprint";
  } else {
    fullscreenBtn.textContent = "⛶ Fullscreen";
  }
});

// === Save Title ===
saveTitleBtn.addEventListener("click", () => {
  const title = titleInput.value.trim();
  if (!title) return alert("❌ Enter a title.");
  customTitle = title;
  fullscreenTitle.textContent = title;
  saveToLocal();
  flashButton(saveTitleBtn);
});
  let wakeLock = null;

  async function requestWakeLock() {
    try {
      wakeLock = await navigator.wakeLock.request('screen');
      console.log('✅ Wake Lock active');
      
      // Agar screen lock hata diya jaye ya browser background me chala jaye
      wakeLock.addEventListener('release', () => {
        console.log('🔁 Wake Lock released, trying to re-acquire...');
        requestWakeLock(); // Retry
      });
    } catch (err) {
      console.error('Wake Lock failed:', err);
    }
  }

  // Jab page load ho
  window.addEventListener('load', () => {
    if ('wakeLock' in navigator) {
      requestWakeLock();
    } else {
      alert("❌ Wake Lock not supported on this browser");
    }
  });

  // Visibility change handle karo (browser minimize ho ya tab switch)
  document.addEventListener('visibilitychange', () => {
    if (document.visibilityState === 'visible') {
      requestWakeLock();
    }
  });
   </script>
</body>
</html>
