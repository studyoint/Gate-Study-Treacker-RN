  <!DOCTYPE html>
  <html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>üéì RN Video Player</title>
  <style>
    body {
      margin: 0;
      background: #0d1117;
      color: #ffffff;
      font-family: 'Segoe UI', sans-serif;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      height: 100vh;
    }

    .container {
      margin-top: 30px;
      width: 90%;
      max-width: 960px;
      background: #161b22;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 0 20px #58a6ff;
    }

    .title {
      text-align: center;
      font-size: 2em;
      color: #58a6ff;
      text-shadow: 0 0 10px #58a6ff;
    }

    .video-wrapper {
      position: relative;
    }

    video {
      width: 100%;
      border-radius: 10px;
      background: black;
      display: block;
    }

    #speedOverlay {
      position: absolute;
      top: 10px;
      right: 15px;
      background: rgba(0, 0, 0, 0.7);
      color: #58a6ff;
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 15px;
      font-weight: bold;
      display: none;
      z-index: 10;
      pointer-events: none;
    }

    .controls {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      align-items: center;
      margin-top: 15px;
      gap: 10px;
    }

    button, select, input[type="range"] {
      padding: 8px 12px;
      border: none;
      border-radius: 6px;
      font-size: 14px;
    }

    button {
      background-color: #58a6ff;
      color: #000;
      cursor: pointer;
    }

    button:hover {
      background-color: #1f6feb;
      color: #fff;
    }

    input[type="file"] {
      margin-top: 10px;
      color: #58a6ff;
      background-color: #0d1117;
      border: 1px solid #58a6ff;
      border-radius: 6px;
    }

    #playlist {
      margin-top: 15px;
      color: #58a6ff;
    }

    .watch-timer {
      color: #00ff88;
      font-family: monospace;
    }
  /* ////////////////// */

    .log-todo-wrapper {
      display: flex;
      justify-content: space-between;
      gap: 20px;
      margin-top: 30px;
      flex-wrap: wrap;
    }

    .log-box, .todo-box {
      /* flex: 1 1 48%; */
      background: #111827;
      border: 1px solid #2d3748;
      border-radius: 12px;
      padding: 20px;
      color: #cbd5e0;
      font-family: 'Segoe UI', sans-serif;
      box-shadow: 0 0 15px rgba(88, 166, 255, 0.3);
      transition: 0.3s ease;
    }

    .log-box:hover, .todo-box:hover {
      box-shadow: 0 0 25px rgba(88, 166, 255, 0.5);
      transform: translateY(-2px);
    }

    .log-box h3, .todo-box h3 {
      color: #58a6ff;
      font-size: 1.4em;
      text-shadow: 0 0 8px #58a6ff;
      margin-bottom: 15px;
    }

    .todo-box label {
      font-weight: 600;
      color: #00ff88;
      display: block;
      margin-bottom: 15px;
      font-size: 1em;
    }

    #lectureCountInput {
      width: 60px;
      padding: 4px;
      border-radius: 4px;
      border: none;
      background: #161b22;
      color: #58a6ff;
    }

    #todoList {
      list-style: none;
      padding-left: 0;
    }

    #todoList li {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 5px 0;
      font-size: 1em;
      color: #e2e8f0;
    }

    #todoList input[type="checkbox"] {
      width: 18px;
      height: 18px;
      accent-color: #58a6ff;
      cursor: pointer;
      border-radius: 4px;
    }

  .done-time {
    color: white;
    font-weight: bold;
    font-size: 0.85em;
    margin-left: 6px;
    margin-bottom: 15px;
  }

  /* ////////////////// */

    @media (max-width: 600px) {
      .controls {
        flex-direction: column;
        align-items: stretch;
      }

      .log-todo-wrapper {
        flex-direction: column;
      }

      .log-box, .todo-box {
        width: 100%;
      }
    }
  </style>

  </head>
  <body>
    <div class="container">
      <h2 class="title">‚ñ∂Ô∏è RN Player</h2>

      <!-- üé• Video Section -->
      <div class="video-wrapper">
        <video id="video" controls></video>
        <div id="speedOverlay">1.0x</div>
      </div>

      <input type="file" id="fileInput" accept="video/*" multiple>

      <!-- üéõ Controls -->
      <div class="controls">
        <button id="playPauseBtn">‚ñ∂Ô∏è Play</button>
        <button onclick="seek(-10)">‚è™ 10s</button>
        <button onclick="seek(10)">‚è© 10s</button>
        <button onclick="toggleFullscreen()">‚õ∂ Fullscreen</button>

        <div id="watchTimer" class="watch-timer"></div>

        <label>
          Speed:
          <select id="speed">
            <option value="0.25">0.25x</option>
            <option value="0.5">0.5x</option>
            <option value="0.75">0.75x</option>
            <option value="1" selected>1x</option>
            <option value="1.25">1.25x</option>
            <option value="1.5">1.5x</option>
            <option value="1.75">1.75x</option>
            <option value="2">2x</option>
            <option value="custom">Custom</option>
          </select>
          <input type="number" id="customSpeed" placeholder="Enter custom speed" step="0.05" min="0.1" max="4" style="display:none; width: 100px;" />
        </label>

        <label>
          Volume:
          <input type="range" id="volume" min="0" max="1" step="0.05">
        </label>
      </div>

      <div id="playlist"></div>

      <!-- ‚úÖ Log + To-Do -->
      <div class="log-todo-wrapper">
        <div id="watchLogSheet" class="log-box">
          <h3>üìò Daily Watch Log</h3>
        </div>

        <div id="todoListSection" class="todo-box">
          <h3>üìù Daily Lecture Checklist</h3>
          <label>
            Total Lectures Today:
            <input type="number" id="lectureCountInput" min="1" max="50" value="10" />
          </label>
          <ul id="todoList"></ul>
        </div>
      </div>
    </div>

<script>
const video = document.getElementById("video");
const fileInput = document.getElementById("fileInput");
const speed = document.getElementById("speed");
const customSpeedInput = document.getElementById("customSpeed");
const volume = document.getElementById("volume");
const playPauseBtn = document.getElementById("playPauseBtn");
const speedOverlay = document.getElementById("speedOverlay");
const playlistDisplay = document.getElementById("playlist");
const watchTimer = document.getElementById("watchTimer");
const watchLogSheet = document.getElementById("watchLogSheet");
const todoList = document.getElementById("todoList");
const lectureCountInput = document.getElementById("lectureCountInput");

let playlist = [], currentIndex = 0, askResume = false;
let videoStartTime = null, watchInterval = null, sessionWatchTime = 0;

function getIndianDateKey() {
  const now = new Date();
  const utc = now.getTime() + (now.getTimezoneOffset() * 60000);
  const ist = new Date(utc + (5.5 * 3600000));
  return ist.toISOString().split("T")[0];
}

function formatTime(ms) {
  const sec = Math.floor(ms / 1000);
  const h = Math.floor(sec / 3600);
  const m = Math.floor((sec % 3600) / 60);
  const s = sec % 60;
  return h > 0 ? `${h}h ${m}m ${s}s` : `${m} min`;
}

function getTodoKey() {
  return `rn_todo_${getIndianDateKey()}`;
}

function saveTodoState() {
  const checkboxes = todoList.querySelectorAll("input[type='checkbox']");
  const states = Array.from(checkboxes).map(c => c.checked);
  localStorage.setItem(getTodoKey(), JSON.stringify(states));
}

function loadTodoState() {
  const data = JSON.parse(localStorage.getItem(getTodoKey()) || "[]");
  return data;
}

function updateWatchLogSheet(msWatched) {
  const key = getIndianDateKey();
  const log = JSON.parse(localStorage.getItem("rn_watch_log") || "{}");
  const prev = log[key] || { ms: 0, lectures: 0 };
  const doneLectures = todoList.querySelectorAll("input[type='checkbox']:checked").length;

  log[key] = {
    ms: prev.ms + msWatched,
    lectures: doneLectures
  };

  localStorage.setItem("rn_watch_log", JSON.stringify(log));
  renderWatchLogSheet();
}
function renderWatchLogSheet() {
  const log = JSON.parse(localStorage.getItem("rn_watch_log") || "{}");

  const lines = Object.entries(log).map(([date, entry]) => {
    let ms = 0;
    let lectures = 0;

    if (typeof entry === "number") {
      // Old format: just time in ms
      ms = entry;
      lectures = 0;
    } else if (typeof entry === "object") {
      ms = entry.ms || 0;
      lectures = entry.lectures || 0;
    }

    return `<div><b>${date}</b>: ${formatTime(ms)}  L${lectures}</div>`;
  });

  watchLogSheet.innerHTML = `<h3>üìò Daily Watch Log</h3>${lines.join("")}`;
}


function renderTodoList() {
  const count = parseInt(lectureCountInput.value) || 10;
  const savedStates = loadTodoState();

  todoList.innerHTML = "";
  for (let i = 1; i <= count; i++) {
    const li = document.createElement("li");
    const checkbox = document.createElement("input");
    checkbox.type = "checkbox";
    checkbox.id = `lecture_${i}`;
    checkbox.checked = savedStates[i - 1] || false;

    const label = document.createElement("label");
    label.setAttribute("for", `lecture_${i}`);
    label.textContent = ` Lecture ${i}`;

    if (checkbox.checked) {
      const span = document.createElement("span");
      span.className = "done-time";
      span.textContent = ` - ${getIndianTimeNow()}`;
      li.appendChild(span);
    }

    checkbox.addEventListener("change", function () {
      const oldTime = li.querySelector(".done-time");
      if (oldTime) oldTime.remove();

      if (this.checked) {
        const span = document.createElement("span");
        span.className = "done-time";
        span.textContent = ` - ${getIndianTimeNow()}`;
        li.appendChild(span);
      }
      saveTodoState();
      updateWatchLogSheet(0); // Update log even without video time
    });

    li.appendChild(checkbox);
    li.appendChild(label);
    todoList.appendChild(li);
  }

  saveTodoState(); // Ensure data is stored on render
}

function getIndianTimeNow() {
  const now = new Date();
  return now.toLocaleTimeString('en-IN', {
    hour: '2-digit',
    minute: '2-digit',
    hour12: true,
    timeZone: 'Asia/Kolkata'
  });
}

function midnightResetCheck() {
  const lastDate = localStorage.getItem("rn_lastChecklistDate");
  const today = getIndianDateKey();

  if (lastDate !== today) {
    localStorage.setItem("rn_lastChecklistDate", today);
    localStorage.removeItem(getTodoKey());
    renderTodoList();
  }
}

window.addEventListener("DOMContentLoaded", () => {
  renderWatchLogSheet();
  renderTodoList();
  midnightResetCheck();
  const lastVideoName = localStorage.getItem("lastPlayedVideoName");
  const lastVideoTime = localStorage.getItem(`rnVideoTime_${lastVideoName}`);
  if (lastVideoName && lastVideoTime) {
    const confirmResume = confirm(`Resume last played video:\n${lastVideoName}?`);
    if (confirmResume) {
      askResume = true;
    }
  }
});

// ==== VIDEO FUNCTIONS ====

function getVideoKey(name) {
  return `rnVideoTime_${name}`;
}

function startWatchTimer() {
  if (videoStartTime === null) {
    videoStartTime = Date.now();
    watchInterval = setInterval(() => {
      const elapsed = Date.now() - videoStartTime;
      sessionWatchTime = elapsed;
      watchTimer.innerText = `‚è±Ô∏è Actual Watch Time: ${formatTime(elapsed)}`;
    }, 1000);
  }
}

function stopWatchTimer() {
  if (videoStartTime !== null) {
    const elapsed = Date.now() - videoStartTime;
    updateWatchLogSheet(elapsed);
  }
  clearInterval(watchInterval);
  watchInterval = null;
  videoStartTime = null;
}

function loadVideo(index, resume = true) {
  const file = playlist[index];
  if (!file) return;
  video.src = URL.createObjectURL(file.file);

  video.addEventListener("loadedmetadata", () => {
    if (resume && askResume) {
      const t = parseFloat(localStorage.getItem(getVideoKey(file.name)) || "0");
      if (t > 0 && t < video.duration) video.currentTime = t;
      askResume = false;
    }
    video.play();
    startWatchTimer();
  }, { once: true });

  video.playbackRate = getCurrentSpeed();
  video.volume = parseFloat(volume.value);
  playlistDisplay.innerHTML = `<b>Now Playing:</b> ${file.name}`;
  localStorage.setItem("lastPlayedVideoName", file.name);
}

fileInput.addEventListener("change", e => {
  playlist = Array.from(e.target.files).map(file => ({ name: file.name, file }));
  const lastVideoName = localStorage.getItem("lastPlayedVideoName");
  const i = playlist.findIndex(v => v.name === lastVideoName);
  currentIndex = i !== -1 && askResume ? i : 0;
  loadVideo(currentIndex, askResume);
});

video.addEventListener("timeupdate", () => {
  if (!video.paused && playlist[currentIndex]) {
    localStorage.setItem(getVideoKey(playlist[currentIndex].name), video.currentTime);
  }
});

video.addEventListener("ended", () => {
  stopWatchTimer();
  alert(`‚úÖ Video Complete!\nActual Watch Time: ${formatTime(sessionWatchTime)}`);
  sessionWatchTime = 0;
  currentIndex++;
  currentIndex < playlist.length
    ? loadVideo(currentIndex)
    : (playlistDisplay.innerHTML = "<i>Playlist finished.</i>",
      localStorage.removeItem("lastPlayedVideoName"));
});

video.addEventListener("play", () => {
  playPauseBtn.innerText = "‚è∏Ô∏è Pause";
  startWatchTimer();
});
video.addEventListener("pause", () => {
  playPauseBtn.innerText = "‚ñ∂Ô∏è Play";
});

speed.addEventListener("change", () => {
  if (speed.value === "custom") {
    customSpeedInput.style.display = "inline-block";
    customSpeedInput.focus();
  } else {
    customSpeedInput.style.display = "none";
    video.playbackRate = parseFloat(speed.value);
    showSpeedOverlay();
  }
});

customSpeedInput.addEventListener("change", () => {
  const val = parseFloat(customSpeedInput.value);
  if (val >= 0.1 && val <= 4) {
    video.playbackRate = val;
    showSpeedOverlay();
  } else alert("Enter value between 0.1 and 4");
});

function getCurrentSpeed() {
  return speed.value === "custom" ? parseFloat(customSpeedInput.value) || 1 : parseFloat(speed.value);
}

volume.addEventListener("input", () => video.volume = parseFloat(volume.value));
playPauseBtn.addEventListener("click", () => video.paused ? video.play() : video.pause());
function seek(sec) { video.currentTime += sec; }
function toggleFullscreen() {
  !document.fullscreenElement ? video.requestFullscreen() : document.exitFullscreen();
}

function showSpeedOverlay() {
  speedOverlay.innerText = video.playbackRate.toFixed(2) + "x";
  speedOverlay.style.display = "block";
  clearTimeout(speedOverlay.timeout);
  speedOverlay.timeout = setTimeout(() => speedOverlay.style.display = "none", 2000);
}

document.addEventListener("keydown", e => {
  if (e.target.tagName.toLowerCase() === "input") return;
  switch (e.key.toLowerCase()) {
    case "p": video.paused ? video.play() : video.pause(); break;
    case "[": seek(-10); break;
    case "]": seek(10); break;
    case "f": toggleFullscreen(); break;
    case "+": video.playbackRate = Math.min(video.playbackRate + 0.1, 4); updateSpeedUI(); showSpeedOverlay(); break;
    case "-": video.playbackRate = Math.max(video.playbackRate - 0.1, 0.1); updateSpeedUI(); showSpeedOverlay(); break;
    case "r": video.playbackRate = 1; speed.value = 1; customSpeedInput.value = ""; customSpeedInput.style.display = "none"; showSpeedOverlay(); break;
  }
});

function updateSpeedUI() {
  const r = video.playbackRate.toFixed(2);
  const exists = Array.from(speed.options).some(opt => parseFloat(opt.value).toFixed(2) === r);
  if (exists) {
    speed.value = r;
    customSpeedInput.style.display = "none";
  } else {
    speed.value = "custom";
    customSpeedInput.style.display = "inline-block";
    customSpeedInput.value = r;
  }
}

lectureCountInput.addEventListener("change", renderTodoList);
</script>


</body>
  </html>
